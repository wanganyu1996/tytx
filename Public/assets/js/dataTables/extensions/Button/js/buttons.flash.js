/*
 * Flash export buttons for Buttons and DataTables.
 * 2015 SpryMedia Ltd - datatables.net/license
 *
 * ZeroClipbaord - MIT license
 * Copyright (c) 2012 Joseph Huckaby
 */
(function(A){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net","datatables.net-buttons"],function(B){return A(B,window,document)})}else{if(typeof exports==="object"){module.exports=function(B,C){if(!B){B=window}if(!C||!C.fn.dataTable){C=require("datatables.net")(B,C).$}if(!C.fn.dataTable.Buttons){require("datatables.net-buttons")(B,C)}return A(C,B,B.document)}}else{A(jQuery,window,document)}}}(function(L,H,G,A){var E=L.fn.dataTable;var I={version:"1.0.4-TableTools2",clients:{},moviePath:"",nextId:1,$:function(N){if(typeof(N)=="string"){N=G.getElementById(N)}if(!N.addClass){N.hide=function(){this.style.display="none"};N.show=function(){this.style.display=""};N.addClass=function(O){this.removeClass(O);this.className+=" "+O};N.removeClass=function(O){this.className=this.className.replace(new RegExp("\\s*"+O+"\\s*")," ").replace(/^\s+/,"").replace(/\s+$/,"")};N.hasClass=function(O){return !!this.className.match(new RegExp("\\s*"+O+"\\s*"))}}return N},setMoviePath:function(N){this.moviePath=N},dispatch:function(Q,N,O){var P=this.clients[Q];if(P){P.receiveEvent(N,O)}},register:function(O,N){this.clients[O]=N},getDOMObjectPosition:function(N){var O={left:0,top:0,width:N.width?N.width:N.offsetWidth,height:N.height?N.height:N.offsetHeight};if(N.style.width!==""){O.width=N.style.width.replace("px","")}if(N.style.height!==""){O.height=N.style.height.replace("px","")}while(N){O.left+=N.offsetLeft;O.top+=N.offsetTop;N=N.offsetParent}return O},Client:function(N){this.handlers={};this.id=I.nextId++;this.movieId="ZeroClipboard_TableToolsMovie_"+this.id;I.register(this.id,this);if(N){this.glue(N)}}};I.Client.prototype={id:0,ready:false,movie:null,clipText:"",fileName:"",action:"copy",handCursorEnabled:true,cssEffects:true,handlers:null,sized:false,glue:function(O,P){this.domElement=I.$(O);var N=99;if(this.domElement.style.zIndex){N=parseInt(this.domElement.style.zIndex,10)+1}var Q=I.getDOMObjectPosition(this.domElement);this.div=G.createElement("div");var R=this.div.style;R.position="absolute";R.left="0px";R.top="0px";R.width=(Q.width)+"px";R.height=Q.height+"px";R.zIndex=N;if(typeof P!="undefined"&&P!==""){this.div.title=P}if(Q.width!==0&&Q.height!==0){this.sized=true}if(this.domElement){this.domElement.appendChild(this.div);this.div.innerHTML=this.getHTML(Q.width,Q.height).replace(/&/g,"&amp;")}},positionElement:function(){var O=I.getDOMObjectPosition(this.domElement);var P=this.div.style;P.position="absolute";P.width=O.width+"px";P.height=O.height+"px";if(O.width!==0&&O.height!==0){this.sized=true}else{return}var N=this.div.childNodes[0];N.width=O.width;N.height=O.height},getHTML:function(R,O){var N="";var Q="id="+this.id+"&width="+R+"&height="+O;if(navigator.userAgent.match(/MSIE/)){var P=location.href.match(/^https/i)?"https://":"http://";N+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+P+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" width="'+R+'" height="'+O+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+I.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+Q+'"/><param name="wmode" value="transparent"/></object>'}else{N+='<embed id="'+this.movieId+'" src="'+I.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+R+'" height="'+O+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+Q+'" wmode="transparent" />'}return N},hide:function(){if(this.div){this.div.style.left="-2000px"}},show:function(){this.reposition()},destroy:function(){var N=this;if(this.domElement&&this.div){L(this.div).remove();this.domElement=null;this.div=null;L.each(I.clients,function(P,O){if(O===N){delete I.clients[P]}})}},reposition:function(O){if(O){this.domElement=I.$(O);if(!this.domElement){this.hide()}}if(this.domElement&&this.div){var N=I.getDOMObjectPosition(this.domElement);var P=this.div.style;P.left=""+N.left+"px";P.top=""+N.top+"px"}},clearText:function(){this.clipText="";if(this.ready){this.movie.clearText()}},appendText:function(N){this.clipText+=N;if(this.ready){this.movie.appendText(N)}},setText:function(N){this.clipText=N;if(this.ready){this.movie.setText(N)}},setFileName:function(N){this.fileName=N;if(this.ready){this.movie.setFileName(N)}},setAction:function(N){this.action=N;if(this.ready){this.movie.setAction(N)}},addEventListener:function(O,N){O=O.toString().toLowerCase().replace(/^on/,"");if(!this.handlers[O]){this.handlers[O]=[]}this.handlers[O].push(N)},setHandCursor:function(N){this.handCursorEnabled=N;if(this.ready){this.movie.setHandCursor(N)}},setCSSEffects:function(N){this.cssEffects=!!N},receiveEvent:function(P,S){var N;P=P.toString().toLowerCase().replace(/^on/,"");switch(P){case"load":this.movie=G.getElementById(this.movieId);if(!this.movie){N=this;setTimeout(function(){N.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){N=this;setTimeout(function(){N.receiveEvent("load",null)},100);this.ready=true;return}this.ready=true;this.movie.clearText();this.movie.appendText(this.clipText);this.movie.setFileName(this.fileName);this.movie.setAction(this.action);this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":if(this.domElement&&this.cssEffects){if(this.recoverActive){this.domElement.addClass("active")}}break;case"mouseout":if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass("active")){this.domElement.removeClass("active");this.recoverActive=true}}break;case"mousedown":if(this.domElement&&this.cssEffects){this.domElement.addClass("active")}break;case"mouseup":if(this.domElement&&this.cssEffects){this.domElement.removeClass("active");this.recoverActive=false}break}if(this.handlers[P]){for(var R=0,Q=this.handlers[P].length;R<Q;R++){var O=this.handlers[P][R];if(typeof(O)=="function"){O(this,S)}else{if((typeof(O)=="object")&&(O.length==2)){O[0][O[1]](this,S)}else{if(typeof(O)=="string"){H[O](this,S)}}}}}}};I.hasFlash=function(){try{var O=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(O){return true}}catch(N){if(navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==A&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return true}}return false};H.ZeroClipboard_TableTools=I;var C=function(O,N){var P=N.attr("id");if(N.parents("html").length){O.glue(N[0],"")}else{setTimeout(function(){C(O,N)},500)}};var D=function(N,P){var O=N.filename==="*"&&N.title!=="*"&&N.title!==A?N.title:N.filename;if(O.indexOf("*")!==-1){O=O.replace("*",L("title").text())}O=O.replace(/[^a-zA-Z0-9_\u00A1-\uFFFF\.,\-_ !\(\)]/g,"");return P===A||P===true?O+N.extension:O};var B=function(N){var O=N.title;return O.indexOf("*")!==-1?O.replace("*",L("title").text()):O};var M=function(P,R){var N=R.match(/[\s\S]{1,8192}/g)||[];P.clearText();for(var O=0,Q=N.length;O<Q;O++){P.appendText(N[O])}};var K=function(N){return N.newline?N.newline:navigator.userAgent.match(/Windows/)?"\r\n":"\n"};var J=function(a,O){var X=K(O);var Q=a.buttons.exportData(O.exportOptions);var W=O.fieldBoundary;var S=O.fieldSeparator;var T=new RegExp(W,"g");var V=O.escapeChar!==A?O.escapeChar:"\\";var Y=function(e){var c="";for(var b=0,d=e.length;b<d;b++){if(b>0){c+=S}c+=W?W+(""+e[b]).replace(T,V+W)+W:e[b]}return c};var Z=O.header?Y(Q.header)+X:"";var P=O.footer?X+Y(Q.footer):"";var R=[];for(var U=0,N=Q.body.length;U<N;U++){R.push(Y(Q.body[U]))}return{str:Z+R.join(X)+P,rows:R.length}};var F={available:function(){return I.hasFlash()},init:function(N,Q,O){I.moviePath=E.Buttons.swfPath;var P=new I.Client();P.setHandCursor(true);P.addEventListener("mouseDown",function(R){O._fromFlash=true;N.button(Q[0]).trigger();O._fromFlash=false});C(P,Q);O._flash=P},destroy:function(N,P,O){O._flash.destroy()},fieldSeparator:",",fieldBoundary:'"',exportOptions:{},title:"*",filename:"*",extension:".csv",header:true,footer:false};E.Buttons.swfPath="//cdn.datatables.net/buttons/1.0.0/swf/flashExport.swf";E.Api.register("buttons.resize()",function(){L.each(I.clients,function(N,O){if(O.domElement!==A&&O.domElement.parentNode){O.positionElement()}})});E.ext.buttons.copyFlash=L.extend({},F,{className:"buttons-copy buttons-flash",text:function(N){return N.i18n("buttons.copy","Copy")},action:function(O,N,R,P){if(!P._fromFlash){return}var Q=P._flash;var S=J(N,P);Q.setAction("copy");M(Q,S.str);N.buttons.info(N.i18n("buttons.copyTitle","Copy to clipboard"),N.i18n("buttons.copyInfo",{_:"Copied %d rows to clipboard",1:"Copied 1 row to clipboard"},S.rows),3000)},fieldSeparator:"\t",fieldBoundary:""});E.ext.buttons.csvFlash=L.extend({},F,{className:"buttons-csv buttons-flash",text:function(N){return N.i18n("buttons.csv","CSV")},action:function(O,N,R,P){var Q=P._flash;var S=J(N,P);Q.setAction("csv");Q.setFileName(D(P));M(Q,S.str)},escapeChar:'"'});E.ext.buttons.excelFlash=L.extend({},F,{className:"buttons-excel buttons-flash",text:function(N){return N.i18n("buttons.excel","Excel")},action:function(Q,W,S,O){var N="";var U=O._flash;var R=W.buttons.exportData(O.exportOptions);var V=function(Z){var a=[];for(var Y=0,X=Z.length;Y<X;Y++){if(Z[Y]===null||Z[Y]===A){Z[Y]=""}a.push(typeof Z[Y]==="number"||(Z[Y].match&&Z[Y].match(/^-?[0-9\.]+$/)&&Z[Y].charAt(0)!=="0")?'<c t="n"><v>'+Z[Y]+"</v></c>":'<c t="inlineStr"><is><t>'+(!Z[Y].replace?Z[Y]:Z[Y].replace(/&(?!amp;)/g,"&amp;").replace(/[\x00-\x1F\x7F-\x9F]/g,""))+"</t></is></c>")}return"<row>"+a.join("")+"</row>"};if(O.header){N+=V(R.header)}for(var T=0,P=R.body.length;T<P;T++){N+=V(R.body[T])}if(O.footer){N+=V(R.footer)}U.setAction("excel");U.setFileName(D(O));M(U,N)},extension:".xlsx"});E.ext.buttons.pdfFlash=L.extend({},F,{className:"buttons-pdf buttons-flash",text:function(N){return N.i18n("buttons.pdf","PDF")},action:function(N,U,Q,O){var T=O._flash;var P=U.buttons.exportData(O.exportOptions);var R=U.table().node().offsetWidth;var S=U.columns(O.columns).indexes().map(function(V){return U.column(V).header().offsetWidth/R});T.setAction("pdf");T.setFileName(B(O));M(T,JSON.stringify({title:D(O,false),message:O.message,colWidth:S.toArray(),orientation:O.orientation,size:O.pageSize,header:O.header?P.header:null,footer:O.footer?P.footer:null,body:P.body}))},extension:".pdf",orientation:"portrait",pageSize:"A4",message:"",newline:"\n"});return E.Buttons}));