/* Buttons for DataTables 1.1.0
 * Â©2015 SpryMedia Ltd - datatables.net/license
 */
(function(A){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function(B){return A(B,window,document)})}else{if(typeof exports==="object"){module.exports=function(B,C){if(!B){B=window}if(!C||!C.fn.dataTable){C=require("datatables.net")(B,C).$}return A(C,B,B.document)}}else{A(jQuery,window,document)}}}(function(J,G,L,A){var C=J.fn.dataTable;var H=0;var E=0;var B=C.ext.buttons;var K=function(M,N){if(N===true){N={}}if(J.isArray(N)){N={buttons:N}}this.c=J.extend(true,{},K.defaults,N);if(N.buttons){this.c.buttons=N.buttons}this.s={dt:new C.Api(M),buttons:[],subButtons:[],listenKeys:"",namespace:"dtb"+(H++)};this.dom={container:J("<"+this.c.dom.container.tag+"/>").addClass(this.c.dom.container.className)};this._constructor()};J.extend(K.prototype,{action:function(O,M){var N=this._indexToButton(O).conf;if(M===A){return N.action}N.action=M;return this},active:function(N,O){var M=this._indexToButton(N);M.node.toggleClass(this.c.dom.button.active,O===A?true:O);return this},add:function(O,N){if(typeof O==="string"&&O.indexOf("-")!==-1){var M=O.split("-");this.c.buttons[M[0]*1].buttons.splice(M[1]*1,0,N)}else{this.c.buttons.splice(O*1,0,N)}this.dom.container.empty();this._buildButtons(this.c.buttons);return this},container:function(){return this.dom.container},disable:function(N){var M=this._indexToButton(N);M.node.addClass(this.c.dom.button.disabled);return this},destroy:function(){J("body").off("keyup."+this.s.namespace);var P=this.s.buttons;var M=this.s.subButtons;var N,Q,R,O;for(N=0,Q=P.length;N<Q;N++){this.removePrep(N);for(R=0,O=M[N].length;R<O;R++){this.removePrep(N+"-"+R)}}this.removeCommit();this.dom.container.remove();var S=this.s.dt.settings()[0];for(N=0,Q=S.length;N<Q;N++){if(S.inst===this){S.splice(N,1);break}}return this},enable:function(N,O){if(O===false){return this.disable(N)}var M=this._indexToButton(N);M.node.removeClass(this.c.dom.button.disabled);return this},name:function(){return this.c.name},node:function(N){var M=this._indexToButton(N);return M.node},removeCommit:function(){var O=this.s.buttons;var M=this.s.subButtons;var N,P,Q;for(N=O.length-1;N>=0;N--){if(O[N]===null){O.splice(N,1);M.splice(N,1);this.c.buttons.splice(N,1)}}for(N=0,P=M.length;N<P;N++){for(Q=M[N].length-1;Q>=0;Q--){if(M[N][Q]===null){M[N].splice(Q,1);this.c.buttons[N].buttons.splice(Q,1)}}}return this},removePrep:function(P){var N;var O=this.s.dt;if(typeof P==="number"||P.indexOf("-")===-1){N=this.s.buttons[P*1];if(N.conf.destroy){N.conf.destroy.call(O.button(P),O,N,N.conf)}N.node.remove();this._removeKey(N.conf);this.s.buttons[P*1]=null}else{var M=P.split("-");N=this.s.subButtons[M[0]*1][M[1]*1];if(N.conf.destroy){N.conf.destroy.call(O.button(P),O,N,N.conf)}N.node.remove();this._removeKey(N.conf);this.s.subButtons[M[0]*1][M[1]*1]=null}return this},text:function(S,M){var N=this._indexToButton(S);var O=this.c.dom.collection.buttonLiner;var R=typeof S==="string"&&S.indexOf("-")!==-1&&O&&O.tag?O.tag:this.c.dom.buttonLiner.tag;var P=this.s.dt;var Q=function(T){return typeof T==="function"?T(P,N.node,N.conf):T};if(M===A){return Q(N.conf.text)}N.conf.text=M;if(R){N.node.children(R).html(Q(M))}else{N.node.html(Q(M))}return this},toIndex:function(P){var N,Q,S,M;var R=this.s.buttons;var O=this.s.subButtons;for(N=0,Q=R.length;N<Q;N++){if(R[N].node[0]===P){return N+""}}for(N=0,Q=O.length;N<Q;N++){for(S=0,M=O[N].length;S<M;S++){if(O[N][S].node[0]===P){return N+"-"+S}}}},_constructor:function(){var N=this;var M=this.s.dt;var O=M.settings()[0];if(!O._buttons){O._buttons=[]}O._buttons.push({inst:this,name:this.c.name});this._buildButtons(this.c.buttons);M.on("destroy",function(){N.destroy()});J("body").on("keyup."+this.s.namespace,function(P){if(!L.activeElement||L.activeElement===L.body){var Q=String.fromCharCode(P.keyCode).toLowerCase();if(N.s.listenKeys.toLowerCase().indexOf(Q)!==-1){N._keypress(Q,P)}}})},_addKey:function(M){if(M.key){this.s.listenKeys+=J.isPlainObject(M.key)?M.key.key:M.key}},_buildButtons:function(U,R,T){var O=this.s.dt;if(!R){R=this.dom.container;this.s.buttons=[];this.s.subButtons=[]}for(var P=0,M=U.length;P<M;P++){var V=this._resolveExtends(U[P]);if(!V){continue}if(J.isArray(V)){this._buildButtons(V,R,T);continue}var S=this._buildButton(V,T!==A?true:false);if(!S){continue}var N=S.node;R.append(S.inserter);if(T===A){this.s.buttons.push({node:N,conf:V,inserter:S.inserter});this.s.subButtons.push([])}else{this.s.subButtons[T].push({node:N,conf:V,inserter:S.inserter})}if(V.buttons){var Q=this.c.dom.collection;V._collection=J("<"+Q.tag+"/>").addClass(Q.className);this._buildButtons(V.buttons,V._collection,P)}if(V.init){V.init.call(O.button(N),O,N,V)}}},_buildButton:function(N,U){var Q=this;var O=this.c.dom.button;var M=this.c.dom.buttonLiner;var V=this.c.dom.collection;var W=this.s.dt;var R=function(X){return typeof X==="function"?X(W,P,N):X};if(U&&V.button){O=V.button}if(U&&V.buttonLiner){M=V.buttonLiner}if(N.available&&!N.available(W,N)){return false}var P=J("<"+O.tag+"/>").addClass(O.className).attr("tabindex",this.s.dt.settings()[0].iTabIndex).attr("aria-controls",this.s.dt.table().node().id).on("click.dtb",function(X){X.preventDefault();if(!P.hasClass(O.disabled)&&N.action){N.action.call(W.button(P),X,W,P,N)}P.blur()}).on("keyup.dtb",function(X){if(X.keyCode===13){if(!P.hasClass(O.disabled)&&N.action){N.action.call(W.button(P),X,W,P,N)}}});if(M.tag){P.append(J("<"+M.tag+"/>").html(R(N.text)).addClass(M.className))}else{P.html(R(N.text))}if(N.enabled===false){P.addClass(O.disabled)}if(N.className){P.addClass(N.className)}if(N.titleAttr){P.attr("title",N.titleAttr)}if(!N.namespace){N.namespace=".dt-button-"+(E++)}var T=this.c.dom.buttonContainer;var S;if(T){S=J("<"+T.tag+"/>").addClass(T.className).append(P)}else{S=P}this._addKey(N);return{node:P,inserter:S}},_indexToButton:function(N){if(typeof N==="number"||N.indexOf("-")===-1){return this.s.buttons[N*1]}var M=N.split("-");return this.s.subButtons[M[0]*1][M[1]*1]},_keypress:function(O,P){var R,M,Q,T;var S=this.s.buttons;var N=this.s.subButtons;var U=function(W,V){if(!W.key){return}if(W.key===O){V.click()}else{if(J.isPlainObject(W.key)){if(W.key.key!==O){return}if(W.key.shiftKey&&!P.shiftKey){return}if(W.key.altKey&&!P.altKey){return}if(W.key.ctrlKey&&!P.ctrlKey){return}if(W.key.metaKey&&!P.metaKey){return}V.click()}}};for(R=0,M=S.length;R<M;R++){U(S[R].conf,S[R].node)}for(R=0,M=N.length;R<M;R++){for(Q=0,T=N[R].length;Q<T;Q++){U(N[R][Q].conf,N[R][Q].node)}}},_removeKey:function(M){if(M.key){var P=J.isPlainObject(M.key)?M.key.key:M.key;var O=this.s.listenKeys.split("");var N=J.inArray(P,O);O.splice(N,1);this.s.listenKeys=O.join("")}},_resolveExtends:function(U){var N=this.s.dt;var P,M;var S=function(W){var V=0;while(!J.isPlainObject(W)&&!J.isArray(W)){if(W===A){return}if(typeof W==="function"){W=W(N,U);if(!W){return false}}else{if(typeof W==="string"){if(!B[W]){throw"Unknown button type: "+W}W=B[W]}}V++;if(V>30){throw"Buttons: Too many iterations"}}return J.isArray(W)?W:J.extend({},W)};U=S(U);while(U&&U.extend){if(!B[U.extend]){throw"Cannot extend unknown button type: "+U.extend}var Q=S(B[U.extend]);if(J.isArray(Q)){return Q}else{if(!Q){return false}}var R=Q.className;U=J.extend({},Q,U);if(R&&U.className!==R){U.className=R+" "+U.className}var O=U.postfixButtons;if(O){if(!U.buttons){U.buttons=[]}for(P=0,M=O.length;P<M;P++){U.buttons.push(O[P])}U.postfixButtons=null}var T=U.prefixButtons;if(T){if(!U.buttons){U.buttons=[]}for(P=0,M=T.length;P<M;P++){U.buttons.splice(P,0,T[P])}U.prefixButtons=null}U.extend=Q.extend}return U}});K.background=function(N,M,O){if(O===A){O=400}if(N){J("<div/>").addClass(M).css("display","none").appendTo("body").fadeIn(O)}else{J("body > div."+M).fadeOut(O,function(){J(this).remove()})}};K.instanceSelector=function(M,O){if(!M){return J.map(O,function(R){return R.inst})}var P=[];var Q=J.map(O,function(R){return R.name});var N=function(T){if(J.isArray(T)){for(var R=0,S=T.length;R<S;R++){N(T[R])}return}if(typeof T==="string"){if(T.indexOf(",")!==-1){N(T.split(","))}else{var U=J.inArray(J.trim(T),Q);if(U!==-1){P.push(O[U].inst)}}}else{if(typeof T==="number"){P.push(O[T].inst)}}};N(M);return P};K.buttonSelector=function(O,Q){var P=[];var S=function(b,W){var Z,T,Y,U;var d=[];J.each(W.s.buttons,function(a,f){if(f!==null){d.push({node:f.node[0],name:f.name})}});J.each(W.s.subButtons,function(a,f){J.each(f,function(h,g){if(g!==null){d.push({node:g.node[0],name:g.name})}})});var e=J.map(d,function(a){return a.node});if(J.isArray(b)||b instanceof J){for(Z=0,T=b.length;Z<T;Z++){S(b[Z],W)}return}if(b===null||b===A||b==="*"){for(Z=0,T=d.length;Z<T;Z++){P.push({inst:W,idx:W.toIndex(d[Z].node)})}}else{if(typeof b==="number"){P.push({inst:W,idx:b})}else{if(typeof b==="string"){if(b.indexOf(",")!==-1){var c=b.split(",");for(Z=0,T=c.length;Z<T;Z++){S(J.trim(c[Z]),W)}}else{if(b.match(/^\d+(\-\d+)?$/)){P.push({inst:W,idx:b})}else{if(b.indexOf(":name")!==-1){var V=b.replace(":name","");for(Z=0,T=d.length;Z<T;Z++){if(d[Z].name===V){P.push({inst:W,idx:W.toIndex(d[Z].node)})}}}else{J(e).filter(b).each(function(){P.push({inst:W,idx:W.toIndex(this)})})}}}}else{if(typeof b==="object"&&b.nodeName){var X=J.inArray(b,e);if(X!==-1){P.push({inst:W,idx:W.toIndex(e[X])})}}}}}};for(var N=0,M=O.length;N<M;N++){var R=O[N];S(Q,R)}return P};K.defaults={buttons:["copy","excel","csv","pdf","print"],name:"main",tabIndex:0,dom:{container:{tag:"div",className:"dt-buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"dt-button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}}};K.version="1.1.0";J.extend(B,{collection:{text:function(M,O,N){return M.i18n("buttons.collection","Collection")},className:"buttons-collection",action:function(M,X,T,N){var Y;var U=T;var R=U.offset();var V=J(X.table().container());var O=false;if(J("div.dt-button-background").length){O=J("div.dt-button-collection").offset();J(L).trigger("click.dtb-collection")}N._collection.addClass(N.collectionLayout).css("display","none").appendTo("body").fadeIn(N.fade);var Q=N._collection.css("position");if(O&&Q==="absolute"){N._collection.css({top:O.top+5,left:O.left+5})}else{if(Q==="absolute"){N._collection.css({top:R.top+U.outerHeight(),left:R.left});var S=R.left+N._collection.outerWidth();var W=V.offset().left+V.width();if(S>W){N._collection.css("left",R.left-(S-W))}}else{var P=N._collection.height()/2;if(P>J(G).height()/2){P=J(G).height()/2}N._collection.css("marginTop",P*-1)}}if(N.background){K.background(true,N.backgroundClassName,N.fade)}setTimeout(function(){J("div.dt-button-background").on("click.dtb-collection",function(){});J("body").on("click.dtb-collection",function(Z){if(!J(Z.target).parents().andSelf().filter(N._collection).length){N._collection.fadeOut(N.fade,function(){N._collection.detach()});J("div.dt-button-background").off("click.dtb-collection");K.background(false,N.backgroundClassName,N.fade);J("body").off("click.dtb-collection")}})},10)},background:true,collectionLayout:"",backgroundClassName:"dt-button-background",fade:400},copy:function(M,N){if(B.copyHtml5){return"copyHtml5"}if(B.copyFlash&&B.copyFlash.available(M,N)){return"copyFlash"}},csv:function(M,N){if(B.csvHtml5&&B.csvHtml5.available(M,N)){return"csvHtml5"}if(B.csvFlash&&B.csvFlash.available(M,N)){return"csvFlash"}},excel:function(M,N){if(B.excelHtml5&&B.excelHtml5.available(M,N)){return"excelHtml5"}if(B.excelFlash&&B.excelFlash.available(M,N)){return"excelFlash"}},pdf:function(M,N){if(B.pdfHtml5&&B.pdfHtml5.available(M,N)){return"pdfHtml5"}if(B.pdfFlash&&B.pdfFlash.available(M,N)){return"pdfFlash"}},pageLength:function(N,P){var O=N.settings()[0].aLengthMenu;var R=J.isArray(O[0])?O[0]:O;var Q=J.isArray(O[0])?O[1]:O;var M=function(S){return S.i18n("buttons.pageLength",{"-1":"Show all rows",_:"Show %d rows"},S.page.len())};return{extend:"collection",text:M,className:"buttons-page-length",buttons:J.map(R,function(T,S){return{text:Q[S],action:function(V,U,X,W){U.page.len(T).draw()},init:function(U,W,X){var V=this;var Y=function(){V.active(U.page.len()===T)};U.on("length.dt"+X.namespace,Y);Y()},destroy:function(U,V,W){U.off("length.dt"+W.namespace)}}}),init:function(S,U,V){var T=this;S.on("length.dt"+V.namespace,function(){T.text(M(S))})},destroy:function(S,T,U){S.off("length.dt"+U.namespace)}}}});C.Api.register("buttons()",function(M,N){if(N===A){N=M;M=A}return this.iterator(true,"table",function(O){if(O._buttons){return K.buttonSelector(K.instanceSelector(M,O._buttons),N)}},true)});C.Api.register("button()",function(M,O){var N=this.buttons(M,O);if(N.length>1){N.splice(1,N.length)}return N});C.Api.register(["buttons().active()","button().active()"],function(M){return this.each(function(N){N.inst.active(N.idx,M)})});C.Api.registerPlural("buttons().action()","button().action()",function(M){if(M===A){return this.map(function(N){return N.inst.action(N.idx)})}return this.each(function(N){N.inst.action(N.idx,M)})});C.Api.register(["buttons().enable()","button().enable()"],function(M){return this.each(function(N){N.inst.enable(N.idx,M)})});C.Api.register(["buttons().disable()","button().disable()"],function(){return this.each(function(M){M.inst.disable(M.idx)})});C.Api.registerPlural("buttons().nodes()","button().node()",function(){var M=J();J(this.each(function(N){M=M.add(N.inst.node(N.idx))}));return M});C.Api.registerPlural("buttons().text()","button().text()",function(M){if(M===A){return this.map(function(N){return N.inst.text(N.idx)})}return this.each(function(N){N.inst.text(N.idx,M)})});C.Api.registerPlural("buttons().trigger()","button().trigger()",function(){return this.each(function(M){M.inst.node(M.idx).trigger("click")})});C.Api.registerPlural("buttons().containers()","buttons().container()",function(){var M=J();J(this.each(function(N){M=M.add(N.inst.container())}));return M});C.Api.register("button().add()",function(N,M){if(this.length===1){this[0].inst.add(N,M)}return this.button(N)});C.Api.register("buttons().destroy()",function(M){this.pluck("inst").unique().each(function(N){N.destroy()});return this});C.Api.registerPlural("buttons().remove()","buttons().remove()",function(){this.each(function(M){M.inst.removePrep(M.idx)});this.pluck("inst").unique().each(function(M){M.removeCommit()});return this});var D;C.Api.register("buttons.info()",function(O,P,M){var N=this;if(O===false){J("#datatables_buttons_info").fadeOut(function(){J(this).remove()});clearTimeout(D);D=null;return this}if(D){clearTimeout(D)}if(J("#datatables_buttons_info").length){J("#datatables_buttons_info").remove()}O=O?"<h2>"+O+"</h2>":"";J('<div id="datatables_buttons_info" class="dt-button-info"/>').html(O).append(J("<div/>")[typeof P==="string"?"html":"append"](P)).css("display","none").appendTo("body").fadeIn();if(M!==A&&M!==0){D=setTimeout(function(){N.buttons.info(false)},M)}return this});C.Api.register("buttons.exportData()",function(M){if(this.context.length){return I(new C.Api(this.context[0]),M)}});var F=J("<textarea/>")[0];var I=function(a,O){var P=J.extend(true,{},{rows:null,columns:"",modifier:{search:"applied",order:"applied"},orthogonal:"display",stripHtml:true,stripNewlines:true,decodeEntities:true,trim:true,format:{header:function(c){return Y(c)},footer:function(c){return Y(c)},body:function(c){return Y(c)}}},O);var Y=function(c){if(typeof c!=="string"){return c}if(P.stripHtml){c=c.replace(/<.*?>/g,"")}if(P.trim){c=c.replace(/^\s+|\s+$/g,"")}if(P.stripNewlines){c=c.replace(/\n/g," ")}if(P.decodeEntities){F.innerHTML=c;c=F.value}return c};var Z=a.columns(P.columns).indexes().map(function(d,c){return P.format.header(a.column(d).header().innerHTML,d)}).toArray();var V=a.table().footer()?a.columns(P.columns).indexes().map(function(e,d){var c=a.column(e).footer();return P.format.footer(c?c.innerHTML:"",e)}).toArray():null;var N=a.rows(P.rows,P.modifier).indexes().toArray();var b=a.cells(N,P.columns).render(P.orthogonal).toArray();var Q=Z.length;var S=Q>0?b.length/Q:0;var W=new Array(S);var X=0;for(var T=0,M=S;T<M;T++){var U=new Array(Q);for(var R=0;R<Q;R++){U[R]=P.format.body(b[X],R,T);X++}W[T]=U}return{header:Z,footer:V,body:W}};J.fn.dataTable.Buttons=K;J.fn.DataTable.Buttons=K;J(L).on("init.dt plugin-init.dt",function(M,P,O){if(M.namespace!=="dt"){return}var N=P.oInit.buttons||C.defaults.buttons;if(N&&!P._buttons){new K(P,N).container()}});C.ext.feature.push({fnInit:function(N){var O=new C.Api(N);var M=O.init().buttons||C.defaults.buttons;return new K(O,M).container()},cFeature:"B"});return K}));