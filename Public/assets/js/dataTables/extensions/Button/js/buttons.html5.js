/*
 * HTML5 export buttons for Buttons and DataTables.
 * 2015 SpryMedia Ltd - datatables.net/license
 *
 * FileSaver.js (2015-05-07.2) - MIT license
 * Copyright Â© 2015 Eli Grey - http://eligrey.com
 */
(function(A){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net","datatables.net-buttons"],function(B){return A(B,window,document)})}else{if(typeof exports==="object"){module.exports=function(B,C){if(!B){B=window}if(!C||!C.fn.dataTable){C=require("datatables.net")(B,C).$}if(!C.fn.dataTable.Buttons){require("datatables.net-buttons")(B,C)}return A(C,B,B.document)}}else{A(jQuery,window,document)}}}(function(K,G,F,A){var E=K.fn.dataTable;var C=(function(Y){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var X=Y.document,Z=function(){return Y.URL||Y.webkitURL||Y},P=X.createElementNS("http://www.w3.org/1999/xhtml","a"),Q="download" in P,R=function(e){var f=X.createEvent("MouseEvents");f.initMouseEvent("click",true,false,Y,0,0,0,0,0,false,false,false,false,0,null);e.dispatchEvent(f)},N=Y.webkitRequestFileSystem,O=Y.requestFileSystem||N||Y.mozRequestFileSystem,T=function(e){(Y.setImmediate||Y.setTimeout)(function(){throw e},0)},a="application/octet-stream",W=0,c=500,d=function(f){var e=function(){if(typeof f==="string"){Z().revokeObjectURL(f)}else{f.remove()}};if(Y.chrome){e()}else{setTimeout(e,c)}},V=function(j,h,k){h=[].concat(h);var f=h.length;while(f--){var e=j["on"+h[f]];if(typeof e==="function"){try{e.call(j,k||j)}catch(g){T(g)}}}},U=function(e){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)){return new Blob(["\ufeff",e],{type:e.type})}return e},b=function(g,f){g=U(g);var i=this,n=g.type,e=false,p,o,j=function(){V(i,"writestart progress write writeend".split(" "))},h=function(){if(e||!p){p=Z().createObjectURL(g)}if(o){o.location.href=p}else{var q=Y.open(p,"_blank");if(q===A&&typeof safari!=="undefined"){Y.location.href=p}}i.readyState=i.DONE;j();d(p)},m=function(q){return function(){if(i.readyState!==i.DONE){return q.apply(this,arguments)}}},k={create:true,exclusive:false},l;i.readyState=i.INIT;if(!f){f="download"}if(Q){p=Z().createObjectURL(g);P.href=p;P.download=f;R(P);i.readyState=i.DONE;j();d(p);return}if(Y.chrome&&n&&n!==a){l=g.slice||g.webkitSlice;g=l.call(g,0,g.size,a);e=true}if(N&&f!=="download"){f+=".download"}if(n===a||N){o=Y}if(!O){h();return}W+=g.size;O(Y.TEMPORARY,W,m(function(q){q.root.getDirectory("saved",k,m(function(r){var s=function(){r.getFile(f,k,m(function(t){t.createWriter(m(function(u){u.onwriteend=function(v){o.location.href=t.toURL();i.readyState=i.DONE;V(i,"writeend",v);d(t)};u.onerror=function(){var v=u.error;if(v.code!==v.ABORT_ERR){h()}};"writestart progress write abort".split(" ").forEach(function(v){u["on"+v]=i["on"+v]});u.write(g);i.abort=function(){u.abort();i.readyState=i.DONE};i.readyState=i.WRITING}),h)}),h)};r.getFile(f,{create:false},m(function(t){t.remove();s()}),m(function(t){if(t.code===t.NOT_FOUND_ERR){s()}else{h()}}))}),h)}),h)},S=b.prototype,M=function(e,f){return new b(e,f)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(e,f){return navigator.msSaveOrOpenBlob(U(e),f)}}S.abort=function(){var e=this;e.readyState=e.DONE;V(e,"abort")};S.readyState=S.INIT=0;S.WRITING=1;S.DONE=2;S.error=S.onwritestart=S.onprogress=S.onwrite=S.onabort=S.onerror=S.onwriteend=null;return M}(G));var D=function(M,O){var N=M.filename==="*"&&M.title!=="*"&&M.title!==A?M.title:M.filename;if(N.indexOf("*")!==-1){N=N.replace("*",K("title").text())}N=N.replace(/[^a-zA-Z0-9_\u00A1-\uFFFF\.,\-_ !\(\)]/g,"");return O===A||O===true?N+M.extension:N};var B=function(M){var N=M.title;return N.indexOf("*")!==-1?N.replace("*",K("title").text()):N};var I=function(M){return M.newline?M.newline:navigator.userAgent.match(/Windows/)?"\r\n":"\n"};var H=function(Z,N){var W=I(N);var P=Z.buttons.exportData(N.exportOptions);var V=N.fieldBoundary;var R=N.fieldSeparator;var S=new RegExp(V,"g");var U=N.escapeChar!==A?N.escapeChar:"\\";var X=function(e){var c="";for(var b=0,d=e.length;b<d;b++){if(b>0){c+=R}c+=V?V+(""+e[b]).replace(S,U+V)+V:e[b]}return c};var Y=N.header?X(P.header)+W:"";var O=N.footer?W+X(P.footer):"";var Q=[];for(var T=0,M=P.body.length;T<M;T++){Q.push(X(P.body[T]))}return{str:Y+Q.join(W)+O,rows:Q.length}};var L=function(){return navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1&&navigator.userAgent.indexOf("Opera")===-1};var J={"_rels/.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">	<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',"xl/_rels/workbook.xml.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">	<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/></Relationships>',"[Content_Types].xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">	<Default Extension="xml" ContentType="application/xml"/>	<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>	<Default Extension="jpeg" ContentType="image/jpeg"/>	<Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>	<Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/></Types>',"xl/workbook.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">	<fileVersion appName="xl" lastEdited="5" lowestEdited="5" rupBuild="24816"/>	<workbookPr showInkAnnotation="0" autoCompressPictures="0"/>	<bookViews>		<workbookView xWindow="0" yWindow="0" windowWidth="25600" windowHeight="19020" tabRatio="500"/>	</bookViews>	<sheets>		<sheet name="Sheet1" sheetId="1" r:id="rId1"/>	</sheets></workbook>',"xl/worksheets/sheet1.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac">	<sheetData>		__DATA__	</sheetData></worksheet>'};E.ext.buttons.copyHtml5={className:"buttons-copy buttons-html5",text:function(M){return M.i18n("buttons.copy","Copy")},action:function(M,Q,T,N){var W=H(Q,N);var R=W.str;var P=K("<div/>").css({height:1,width:1,overflow:"hidden",position:"fixed",top:0,left:0});var V=K("<textarea readonly/>").val(R).appendTo(P);if(F.queryCommandSupported("copy")){P.appendTo("body");V[0].focus();V[0].select();try{F.execCommand("copy");P.remove();Q.buttons.info(Q.i18n("buttons.copyTitle","Copy to clipboard"),Q.i18n("buttons.copySuccess",{1:"Copied one row to clipboard",_:"Copied %d rows to clipboard"},W.rows),2000);return}catch(S){}}var X=K("<span>"+Q.i18n("buttons.copyKeys","Press <i>ctrl</i> or <i>\u2318</i> + <i>C</i> to copy the table data<br>to your system clipboard.<br><br>To cancel, click this message or press escape.")+"</span>").append(P);Q.buttons.info(Q.i18n("buttons.copyTitle","Copy to clipboard"),X,0);V[0].focus();V[0].select();var U=K(X).closest(".dt-button-info");var O=function(){U.off("click.buttons-copy");K(F).off(".buttons-copy");Q.buttons.info(false)};U.on("click.buttons-copy",O);K(F).on("keydown.buttons-copy",function(Y){if(Y.keyCode===27){O()}}).on("copy.buttons-copy cut.buttons-copy",function(){O()})},exportOptions:{},fieldSeparator:"\t",fieldBoundary:"",header:true,footer:false};E.ext.buttons.csvHtml5={className:"buttons-csv buttons-html5",available:function(){return G.FileReader!==A&&G.Blob},text:function(M){return M.i18n("buttons.csv","CSV")},action:function(N,M,Q,O){var R=I(O);var S=H(M,O).str;var P=O.charset;if(P!==false){if(!P){P=F.characterSet||F.charset}if(P){P=";charset="+P}}else{P=""}C(new Blob([S],{type:"text/csv"+P}),D(O))},filename:"*",extension:".csv",exportOptions:{},fieldSeparator:",",fieldBoundary:'"',escapeChar:'"',charset:null,header:true,footer:false};E.ext.buttons.excelHtml5={className:"buttons-excel buttons-html5",available:function(){return G.FileReader!==A&&G.JSZip!==A&&!L()},text:function(M){return M.i18n("buttons.excel","Excel")},action:function(P,Z,U,N){var M="";var Q=Z.buttons.exportData(N.exportOptions);var Y=function(c){var d=[];for(var b=0,a=c.length;b<a;b++){if(c[b]===null||c[b]===A){c[b]=""}d.push(typeof c[b]==="number"||(c[b].match&&c[b].match(/^-?[0-9\.]+$/)&&c[b].charAt(0)!=="0")?'<c t="n"><v>'+c[b]+"</v></c>":'<c t="inlineStr"><is><t>'+(!c[b].replace?c[b]:c[b].replace(/&(?!amp;)/g,"&amp;").replace(/[\x00-\x1F\x7F-\x9F]/g,""))+"</t></is></c>")}return"<row>"+d.join("")+"</row>"};if(N.header){M+=Y(Q.header)}for(var W=0,O=Q.body.length;W<O;W++){M+=Y(Q.body[W])}if(N.footer){M+=Y(Q.footer)}var X=new G.JSZip();var R=X.folder("_rels");var T=X.folder("xl");var V=X.folder("xl/_rels");var S=X.folder("xl/worksheets");X.file("[Content_Types].xml",J["[Content_Types].xml"]);R.file(".rels",J["_rels/.rels"]);T.file("workbook.xml",J["xl/workbook.xml"]);V.file("workbook.xml.rels",J["xl/_rels/workbook.xml.rels"]);S.file("sheet1.xml",J["xl/worksheets/sheet1.xml"].replace("__DATA__",M));C(X.generate({type:"blob"}),D(N))},filename:"*",extension:".xlsx",exportOptions:{},header:true,footer:false};E.ext.buttons.pdfHtml5={className:"buttons-pdf buttons-html5",available:function(){return G.FileReader!==A&&G.pdfMake},text:function(M){return M.i18n("buttons.pdf","PDF")},action:function(M,W,S,Q){var V=I(Q);var R=W.buttons.exportData(Q.exportOptions);var N=[];if(Q.header){N.push(K.map(R.header,function(X){return{text:typeof X==="string"?X:X+"",style:"tableHeader"}}))}for(var T=0,O=R.body.length;T<O;T++){N.push(K.map(R.body[T],function(X){return{text:typeof X==="string"?X:X+"",style:T%2?"tableBodyEven":"tableBodyOdd"}}))}if(Q.footer){N.push(K.map(R.footer,function(X){return{text:typeof X==="string"?X:X+"",style:"tableFooter"}}))}var P={pageSize:Q.pageSize,pageOrientation:Q.orientation,content:[{table:{headerRows:1,body:N},layout:"noBorders"}],styles:{tableHeader:{bold:true,fontSize:11,color:"white",fillColor:"#2d4154",alignment:"center"},tableBodyEven:{},tableBodyOdd:{fillColor:"#f3f3f3"},tableFooter:{bold:true,fontSize:11,color:"white",fillColor:"#2d4154"},title:{alignment:"center",fontSize:15},message:{}},defaultStyle:{fontSize:10}};if(Q.message){P.content.unshift({text:Q.message,style:"message",margin:[0,0,0,12]})}if(Q.title){P.content.unshift({text:B(Q,false),style:"title",margin:[0,0,0,12]})}if(Q.customize){Q.customize(P)}var U=G.pdfMake.createPdf(P);if(Q.download==="open"&&!L()){U.open()}else{U.getBuffer(function(X){var Y=new Blob([X],{type:"application/pdf"});C(Y,D(Q))})}},title:"*",filename:"*",extension:".pdf",exportOptions:{},orientation:"portrait",pageSize:"A4",header:true,footer:false,message:null,customize:null,download:"download"};return E.Buttons}));